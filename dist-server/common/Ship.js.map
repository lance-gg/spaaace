{"version":3,"file":"Ship.js","names":["_lanceGg","require","_ShipActor","_interopRequireDefault","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","Number","_get","Reflect","get","bind","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","arguments","value","apply","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","Ship","_DynamicObject","_super","gameEngine","options","_this","showThrust","onAddToWorld","Renderer","renderer","getInstance","shipActor","ShipActor","sprite","sprites","id","position","set","x","y","layer2","addChild","isOwnedByPlayer","addPlayerShip","addOffscreenIndicator","onRemoveFromWorld","_this2","fireLoop","destroy","onPreStep","removeListener","playerShip","removeOffscreenIndicator","actor","then","angleLocal","percent","max","toString","concat","isBot","syncTo","other","attachAI","_this3","steer","on","fireLoopTime","Math","round","random","timer","loop","distanceToTargetSquared","makeMissile","shortestVector","p1","p2","wrapDist","d","abs","dx","worldSettings","width","dy","height","closestTarget","closestDistance2","Infinity","_i","_Object$keys","keys","world","objects","objId","distance2","newVX","newVY","angleToTarget","atan2","PI","turnRight","angle","turnLeft","accelerate","assign","type","BaseTypes","TYPES","INT32","DynamicObject","exports"],"sources":["../../src/common/Ship.js"],"sourcesContent":["import { BaseTypes, DynamicObject, Renderer } from 'lance-gg';\nimport ShipActor from '../client/ShipActor';\n\nexport default class Ship extends DynamicObject {\n\n    constructor(gameEngine, options, props) {\n        super(gameEngine, options, props);\n        this.showThrust = 0;\n    }\n\n    get maxSpeed() { return 3.0; }\n\n    onAddToWorld(gameEngine) {\n        if (Renderer) {\n            let renderer = Renderer.getInstance();\n            let shipActor = new ShipActor(renderer);\n            let sprite = shipActor.sprite;\n            renderer.sprites[this.id] = sprite;\n            sprite.id = this.id;\n            sprite.position.set(this.position.x, this.position.y);\n            renderer.layer2.addChild(sprite);\n\n            if (gameEngine.isOwnedByPlayer(this)) {\n                renderer.addPlayerShip(sprite);\n            } else {\n                renderer.addOffscreenIndicator(this);\n            }\n        }\n    }\n\n    onRemoveFromWorld(gameEngine) {\n\n        if (this.fireLoop) {\n            this.fireLoop.destroy();\n        }\n\n        if (this.onPreStep){\n            this.gameEngine.removeListener('preStep', this.onPreStep);\n            this.onPreStep = null;\n        }\n\n        if (Renderer) {\n            let renderer = Renderer.getInstance();\n            if (gameEngine.isOwnedByPlayer(this)) {\n                renderer.playerShip = null;\n            } else {\n                renderer.removeOffscreenIndicator(this);\n            }\n            let sprite = renderer.sprites[this.id];\n            if (sprite) {\n                if (sprite.actor) {\n                    // removal \"takes time\"\n                    sprite.actor.destroy().then(()=>{\n                        delete renderer.sprites[this.id];\n                    });\n                } else {\n                    sprite.destroy();\n                    delete renderer.sprites[this.id];\n                }\n            }\n        }\n    }\n\n    // no bending corrections on angle needed, angle is deterministic\n    // position correction if less than world width/height\n    get bending() {\n        return { angleLocal: { percent: 0.0 }, position: { max: 500.0 } };\n    }\n\n    static get netScheme() {\n        return Object.assign({\n            showThrust: { type: BaseTypes.TYPES.INT32 }\n        }, super.netScheme);\n    }\n\n    toString() {\n        return `${this.isBot?'Bot':'Player'}::Ship::${super.toString()}`;\n    }\n\n    syncTo(other) {\n        super.syncTo(other);\n        this.showThrust = other.showThrust;\n    }\n\n\n    destroy() {\n    }\n\n    attachAI() {\n        this.isBot = true;\n\n        this.onPreStep = () => {\n            this.steer();\n        };\n\n        this.gameEngine.on('preStep', this.onPreStep);\n\n        let fireLoopTime = Math.round(250 + Math.random() * 100);\n        this.fireLoop = this.gameEngine.timer.loop(fireLoopTime, () => {\n            if (this.target && this.distanceToTargetSquared(this.target) < 160000) {\n                this.gameEngine.makeMissile(this);\n            }\n        });\n    }\n\n    shortestVector(p1, p2, wrapDist) {\n        let d = Math.abs(p2 - p1);\n        if (d > Math.abs(p2 + wrapDist - p1)) p2 += wrapDist;\n        else if (d > Math.abs(p1 + wrapDist - p2)) p1 += wrapDist;\n        return p2 - p1;\n    }\n\n    distanceToTargetSquared(target) {\n        let dx = this.shortestVector(this.position.x, target.position.x, this.gameEngine.worldSettings.width);\n        let dy = this.shortestVector(this.position.y, target.position.y, this.gameEngine.worldSettings.height);\n        return dx * dx + dy * dy;\n    }\n\n    steer() {\n        let closestTarget = null;\n        let closestDistance2 = Infinity;\n        for (let objId of Object.keys(this.gameEngine.world.objects)) {\n            let obj = this.gameEngine.world.objects[objId];\n            if (obj != this) {\n                let distance2 = this.distanceToTargetSquared(obj);\n                if (distance2 < closestDistance2) {\n                    closestTarget = obj;\n                    closestDistance2 = distance2;\n                }\n            }\n        }\n\n        this.target = closestTarget;\n\n        if (this.target) {\n\n            let newVX = this.shortestVector(this.position.x, this.target.position.x, this.gameEngine.worldSettings.width);\n            let newVY = this.shortestVector(this.position.y, this.target.position.y, this.gameEngine.worldSettings.height);\n            let angleToTarget = Math.atan2(newVX, newVY)/Math.PI* 180;\n            angleToTarget *= -1;\n            angleToTarget += 90; // game uses zero angle on the right, clockwise\n            if (angleToTarget < 0) angleToTarget += 360;\n            let turnRight = this.shortestVector(this.angle, angleToTarget, 360);\n\n            if (turnRight > 4) {\n                this.turnRight(2.5);\n            } else if (turnRight < -4) {\n                this.turnLeft(2.5);\n            } else {\n                this.accelerate(0.05);\n                this.showThrust = 5;\n            }\n\n        }\n    }\n}\n"],"mappings":"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"}