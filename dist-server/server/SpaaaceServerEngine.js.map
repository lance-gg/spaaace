{"version":3,"sources":["../../src/server/SpaaaceServerEngine.js"],"names":["nameGenerator","require","NUM_BOTS","SpaaaceServerEngine","io","gameEngine","inputOptions","scoreData","on","e","roomName","missile","ownerId","kills","ship","id","updateScore","removeObjectFromWorld","socket","URL","handshake","headers","referer","parts","url","parse","query","assetId","playerId","makePlayerShip","console","log","rooms","makeShip","assignObjectToRoom","name","socketId","playerObjects","world","queryObjects","forEach","obj","_roomName","setTimeout","sockets","emit","ServerEngine"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAMA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAA7B;;AACA,IAAMC,QAAQ,GAAG,CAAjB;;IAEqBC,mB;;;;;AACnB,+BAAYC,EAAZ,EAAgBC,UAAhB,EAA4BC,YAA5B,EAA0C;AAAA;;AAAA;;AACxC,8BAAMF,EAAN,EAAUC,UAAV,EAAsBC,YAAtB;AACA,UAAKC,SAAL,GAAiB,EAAjB;AAFwC;AAGzC,G,CAED;AACA;;;;;4BACQ;AAAA;;AACN,qFADM,CAGN;AAEA;;;AAEA,WAAKF,UAAL,CAAgBG,EAAhB,CAAmB,YAAnB,EAAiC,UAACC,CAAD,EAAO;AACtC;AACA,YAAMC,QAAQ,GAAGD,CAAC,CAACE,OAAF,CAAUD,QAA3B;AACA,YAAI,MAAI,CAACH,SAAL,CAAeG,QAAf,EAAyBD,CAAC,CAACE,OAAF,CAAUC,OAAnC,CAAJ,EAAiD,MAAI,CAACL,SAAL,CAAeG,QAAf,EAAyBD,CAAC,CAACE,OAAF,CAAUC,OAAnC,EAA4CC,KAA5C,GAHX,CAKtC;;AACA,eAAO,MAAI,CAACN,SAAL,CAAeG,QAAf,EAAyBD,CAAC,CAACK,IAAF,CAAOC,EAAhC,CAAP;;AACA,QAAA,MAAI,CAACC,WAAL,GAPsC,CAStC;;;AACA,QAAA,MAAI,CAACX,UAAL,CAAgBY,qBAAhB,CAAsCR,CAAC,CAACK,IAAF,CAAOC,EAA7C,EAVsC,CAWtC;AACA;AACA;;AACD,OAdD;AAeD,K,CAED;;;;sCACkBG,M,EAAQ;AAAA;;AACxB,iGAAwBA,MAAxB,EADwB,CAGxB;;;AACA,UAAMC,GAAG,GAAGD,MAAM,CAACE,SAAP,CAAiBC,OAAjB,CAAyBC,OAArC;;AACA,UAAMC,KAAK,GAAGC,gBAAIC,KAAJ,CAAUN,GAAV,EAAe,IAAf,CAAd;;AACA,UAAMO,KAAK,GAAGH,KAAK,CAACG,KAApB;AACA,UAAMC,OAAO,GAAGD,KAAK,CAACC,OAAtB;;AAEA,0FAAiBA,OAAjB;;AACA,kGAAyBT,MAAM,CAACU,QAAhC,EAA0CD,OAA1C;;AACA,WAAKpB,SAAL,CAAeoB,OAAf,IAA0B,KAAKpB,SAAL,CAAeoB,OAAf,KAA2B,EAArD;;AAEA,UAAIE,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AACzBC,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB,MAAI,CAACC,KAA1B;;AACA,YAAIlB,IAAI,GAAG,MAAI,CAACT,UAAL,CAAgB4B,QAAhB,CAAyBf,MAAM,CAACU,QAAhC,CAAX;;AACA,QAAA,MAAI,CAACM,kBAAL,CAAwBpB,IAAxB,EAA8Ba,OAA9B;;AAEA,QAAA,MAAI,CAACpB,SAAL,CAAeoB,OAAf,EAAwBb,IAAI,CAACC,EAA7B,IAAmC;AACjCF,UAAAA,KAAK,EAAE,CAD0B;AAEjCsB,UAAAA,IAAI,EAAEnC,aAAa,CAAC,SAAD;AAFc,SAAnC;;AAIA,QAAA,MAAI,CAACgB,WAAL;AACD,OAVD,CAbwB,CAyBxB;;;AACAE,MAAAA,MAAM,CAACV,EAAP,CAAU,gBAAV,EAA4BqB,cAA5B;AACD,K,CAED;;;;yCACqBO,Q,EAAUR,Q,EAAU;AAAA;;AACvC,oGAA2BQ,QAA3B,EAAqCR,QAArC,EADuC,CAGvC;;;AACA,UAAIS,aAAa,GAAG,KAAKhC,UAAL,CAAgBiC,KAAhB,CAAsBC,YAAtB,CAAmC;AAAEX,QAAAA,QAAQ,EAAEA;AAAZ,OAAnC,CAApB;AACAS,MAAAA,aAAa,CAACG,OAAd,CAAsB,UAACC,GAAD,EAAS;AAC7B,QAAA,MAAI,CAACpC,UAAL,CAAgBY,qBAAhB,CAAsCwB,GAAG,CAAC1B,EAA1C;;AACAe,QAAAA,OAAO,CAACC,GAAR,CAAYU,GAAZ,EAF6B,CAG7B;;AACA,eAAO,MAAI,CAAClC,SAAL,CAAekC,GAAG,CAACC,SAAnB,EAA8BD,GAAG,CAAC1B,EAAlC,CAAP;AACD,OALD;AAOA,WAAKC,WAAL;AACD,K,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;kCAEc;AAAA;;AACZ;AACA2B,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,MAAI,CAACvC,EAAL,CAAQwC,OAAR,CAAgBC,IAAhB,CAAqB,aAArB,EAAoC,MAAI,CAACtC,SAAzC;AACD,OAFS,EAEP,IAFO,CAAV;AAGD;;;;EA9F8CuC,qB","sourcesContent":["import url from \"url\";\nimport { ServerEngine } from \"lance-gg\";\nconst nameGenerator = require(\"./NameGenerator\");\nconst NUM_BOTS = 0;\n\nexport default class SpaaaceServerEngine extends ServerEngine {\n  constructor(io, gameEngine, inputOptions) {\n    super(io, gameEngine, inputOptions);\n    this.scoreData = {};\n  }\n\n  // when the game starts, create robot spaceships, and register\n  // on missile-hit events\n  start() {\n    super.start();\n\n    // Room IDs https://github.com/jungbeomsu/Test/blob/fe9474c67073121937726deb54f0e53eb11eb4c4/src/gameServer/TownServerEngine.js\n\n    // for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\n\n    this.gameEngine.on(\"missileHit\", (e) => {\n      // add kills\n      const roomName = e.missile.roomName;\n      if (this.scoreData[roomName][e.missile.ownerId]) this.scoreData[roomName][e.missile.ownerId].kills++;\n\n      // remove score data for killed ship\n      delete this.scoreData[roomName][e.ship.id];\n      this.updateScore();\n\n      //   console.log(`ship killed: ${e.ship.toString()}`);\n      this.gameEngine.removeObjectFromWorld(e.ship.id);\n      //   if (e.ship.isBot) {\n      //     setTimeout(() => this.makeBot(), 5000);\n      //   }\n    });\n  }\n\n  // a player has connected\n  onPlayerConnected(socket) {\n    super.onPlayerConnected(socket);\n\n    // Get the query parameters out of the URL\n    const URL = socket.handshake.headers.referer;\n    const parts = url.parse(URL, true);\n    const query = parts.query;\n    const assetId = query.assetId;\n\n    super.createRoom(assetId);\n    super.assignPlayerToRoom(socket.playerId, assetId);\n    this.scoreData[assetId] = this.scoreData[assetId] || {};\n\n    let makePlayerShip = () => {\n      console.log(\"Rooms\", this.rooms);\n      let ship = this.gameEngine.makeShip(socket.playerId);\n      this.assignObjectToRoom(ship, assetId);\n\n      this.scoreData[assetId][ship.id] = {\n        kills: 0,\n        name: nameGenerator(\"general\"),\n      };\n      this.updateScore();\n    };\n\n    // handle client restart requests\n    socket.on(\"requestRestart\", makePlayerShip);\n  }\n\n  // a player has disconnected\n  onPlayerDisconnected(socketId, playerId) {\n    super.onPlayerDisconnected(socketId, playerId);\n\n    // iterate through all objects, delete those that are associated with the player (ship and missiles)\n    let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\n    playerObjects.forEach((obj) => {\n      this.gameEngine.removeObjectFromWorld(obj.id);\n      console.log(obj);\n      //   // remove score associated with this ship\n      delete this.scoreData[obj._roomName][obj.id];\n    });\n\n    this.updateScore();\n  }\n\n  //   // create a robot spaceship\n  //   makeBot() {\n  //     let bot = this.gameEngine.makeShip(0);\n  //     bot.attachAI();\n  //     this.scoreData[bot.id] = {\n  //       kills: 0,\n  //       name: nameGenerator(\"general\") + \"Bot\",\n  //     };\n  //     this.updateScore();\n  //   }\n\n  updateScore() {\n    // delay so player socket can catch up\n    setTimeout(() => {\n      this.io.sockets.emit(\"scoreUpdate\", this.scoreData);\n    }, 1000);\n  }\n}\n"],"file":"SpaaaceServerEngine.js"}