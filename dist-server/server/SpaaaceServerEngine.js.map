{"version":3,"sources":["../../src/server/SpaaaceServerEngine.js"],"names":["nameGenerator","require","NUM_BOTS","roomName","SpaaaceServerEngine","io","gameEngine","inputOptions","scoreData","x","makeBot","on","e","missile","ownerId","kills","ship","id","updateScore","removeObjectFromWorld","isBot","setTimeout","socket","playerId","makePlayerShip","console","log","rooms","makeShip","assignObjectToRoom","name","socketId","playerObjects","world","queryObjects","forEach","obj","bot","attachAI","sockets","emit","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine } from \"lance-gg\";\nconst nameGenerator = require(\"./NameGenerator\");\nconst NUM_BOTS = 0;\nconst roomName = \"/hi\";\n\nexport default class SpaaaceServerEngine extends ServerEngine {\n  constructor(io, gameEngine, inputOptions) {\n    super(io, gameEngine, inputOptions);\n    this.scoreData = {};\n  }\n\n  // when the game starts, create robot spaceships, and register\n  // on missile-hit events\n  start() {\n    super.start();\n    super.createRoom(roomName);\n    // Room IDs https://github.com/jungbeomsu/Test/blob/fe9474c67073121937726deb54f0e53eb11eb4c4/src/gameServer/TownServerEngine.js\n\n    for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\n\n    this.gameEngine.on(\"missileHit\", (e) => {\n      // add kills\n      if (this.scoreData[e.missile.ownerId]) this.scoreData[e.missile.ownerId].kills++;\n\n      // remove score data for killed ship\n      delete this.scoreData[e.ship.id];\n      this.updateScore();\n\n      //   console.log(`ship killed: ${e.ship.toString()}`);\n      this.gameEngine.removeObjectFromWorld(e.ship.id);\n      if (e.ship.isBot) {\n        setTimeout(() => this.makeBot(), 5000);\n      }\n    });\n  }\n\n  // a player has connected\n  onPlayerConnected(socket) {\n    super.onPlayerConnected(socket);\n    // console.log(\"Game status\", super.gameStatus());\n    super.assignPlayerToRoom(socket.playerId, roomName);\n\n    let makePlayerShip = () => {\n      console.log(\"Rooms\", this.rooms);\n      let ship = this.gameEngine.makeShip(socket.playerId);\n      this.assignObjectToRoom(ship, roomName);\n\n      this.scoreData[ship.id] = {\n        kills: 0,\n        name: nameGenerator(\"general\"),\n      };\n      this.updateScore();\n    };\n\n    // handle client restart requests\n    socket.on(\"requestRestart\", makePlayerShip);\n  }\n\n  // a player has disconnected\n  onPlayerDisconnected(socketId, playerId) {\n    super.onPlayerDisconnected(socketId, playerId);\n\n    // iterate through all objects, delete those that are associated with the player (ship and missiles)\n    let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\n    playerObjects.forEach((obj) => {\n      this.gameEngine.removeObjectFromWorld(obj.id);\n      // remove score associated with this ship\n      delete this.scoreData[obj.id];\n    });\n\n    this.updateScore();\n  }\n\n  // create a robot spaceship\n  makeBot() {\n    let bot = this.gameEngine.makeShip(0);\n    bot.attachAI();\n    this.scoreData[bot.id] = {\n      kills: 0,\n      name: nameGenerator(\"general\") + \"Bot\",\n    };\n    this.updateScore();\n  }\n\n  updateScore() {\n    // delay so player socket can catch up\n    setTimeout(() => {\n      this.io.sockets.emit(\"scoreUpdate\", this.scoreData);\n    }, 1000);\n  }\n}\n"],"file":"SpaaaceServerEngine.js"}