{"version":3,"sources":["../../src/client/ShipActor.js"],"names":["PIXI","PixiParticles","ShipActor","renderer","require","gameEngine","backLayer","layer1","sprite","Container","shipContainerSprite","shipSprite","Sprite","loader","resources","ship","texture","actor","anchor","set","width","height","addThrustEmitter","addChild","delta","thrustEmitter","update","spawnPos","x","Math","cos","rotation","y","sin","minStartRotation","PI","maxStartRotation","explosionEmitter","particles","Emitter","smokeParticle","ThrusterEmitterConfig","emit","ExplosionEmitterConfig","name","nameText","destroy","Text","fontFamily","fontSize","fill","alpha","Promise","resolve","setTimeout"],"mappings":"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","sourcesContent":["import ThrusterEmitterConfig from './ThrusterEmitter.json';\nimport ExplosionEmitterConfig from './ExplosionEmitter.json';\n\nlet PIXI = null;\nlet PixiParticles = null;\n\nexport default class ShipActor {\n\n    constructor(renderer) {\n        PIXI = require('pixi.js');\n        PixiParticles = require('pixi-particles');\n        this.gameEngine = renderer.gameEngine;\n        this.backLayer = renderer.layer1;\n        this.sprite = new PIXI.Container();\n        this.shipContainerSprite = new PIXI.Container();\n\n        this.shipSprite = new PIXI.Sprite(PIXI.loader.resources.ship.texture);\n\n        // keep a reference to the actor from the sprite\n        this.sprite.actor = this;\n\n\n        this.shipSprite.anchor.set(0.5, 0.5);\n        this.shipSprite.width = 50;\n        this.shipSprite.height = 45;\n\n\n        this.addThrustEmitter();\n        this.sprite.addChild(this.shipContainerSprite);\n        this.shipContainerSprite.addChild(this.shipSprite);\n    }\n\n    renderStep(delta) {\n        if (this.thrustEmitter) {\n            this.thrustEmitter.update(delta * 0.001);\n\n            this.thrustEmitter.spawnPos.x = this.sprite.x - Math.cos(-this.shipContainerSprite.rotation) * 4;\n            this.thrustEmitter.spawnPos.y = this.sprite.y + Math.sin(-this.shipContainerSprite.rotation) * 4;\n\n            this.thrustEmitter.minStartRotation = this.shipContainerSprite.rotation * 180 / Math.PI + 180 - 1;\n            this.thrustEmitter.maxStartRotation = this.shipContainerSprite.rotation * 180 / Math.PI + 180 + 1;\n        }\n        if (this.explosionEmitter){\n            this.explosionEmitter.update(delta * 0.001);\n        }\n\n    }\n\n    addThrustEmitter() {\n        this.thrustEmitter = new PIXI.particles.Emitter(\n            this.backLayer,\n            [PIXI.loader.resources.smokeParticle.texture],\n            ThrusterEmitterConfig\n        );\n        this.thrustEmitter.emit = false;\n\n        this.explosionEmitter = new PIXI.particles.Emitter(\n            this.shipContainerSprite,\n            [PIXI.loader.resources.smokeParticle.texture],\n            ExplosionEmitterConfig\n        );\n\n        this.explosionEmitter.emit = false;\n    }\n\n    changeName(name) {\n        if (this.nameText != null){\n            this.nameText.destroy();\n        }\n        this.nameText = new PIXI.Text(name, { fontFamily: 'arial', fontSize: '12px', fill: 'white' });\n        this.nameText.anchor.set(0.5, 0.5);\n        this.nameText.y = -40;\n        this.nameText.alpha = 0.3;\n        this.sprite.addChild(this.nameText);\n    }\n\n    destroy() {\n        return new Promise((resolve) =>{\n            this.explosionEmitter.emit = true;\n\n            if (this.nameText) this.nameText.destroy({ texture: false });\n            if (this.thrustEmitter) this.thrustEmitter.destroy();\n            if (this.shipSprite) this.shipSprite.destroy();\n            this.nameText = null;\n            this.thrustEmitter = null;\n            this.shipSprite = null;\n\n            setTimeout(()=>{\n                this.shipContainerSprite.destroy();\n                this.explosionEmitter.destroy();\n                resolve();\n            }, 300);\n        });\n    }\n\n}\n"],"file":"ShipActor.js"}