{"version":3,"file":"ShipActor.js","names":["PIXI","PixiParticles","ShipActor","renderer","_classCallCheck","require","gameEngine","backLayer","layer1","sprite","Container","shipContainerSprite","shipSprite","Sprite","loader","resources","ship","texture","actor","anchor","set","width","height","addThrustEmitter","addChild","_createClass","key","value","renderStep","delta","thrustEmitter","update","spawnPos","x","Math","cos","rotation","y","sin","minStartRotation","PI","maxStartRotation","explosionEmitter","particles","Emitter","smokeParticle","ThrusterEmitterConfig","emit","ExplosionEmitterConfig","changeName","name","nameText","destroy","Text","fontFamily","fontSize","fill","alpha","_this","Promise","resolve","setTimeout","exports"],"sources":["../../src/client/ShipActor.js"],"sourcesContent":["import ThrusterEmitterConfig from './ThrusterEmitter.json';\nimport ExplosionEmitterConfig from './ExplosionEmitter.json';\n\nlet PIXI = null;\nlet PixiParticles = null;\n\nexport default class ShipActor {\n\n    constructor(renderer) {\n        PIXI = require('pixi.js');\n        PixiParticles = require('pixi-particles');\n        this.gameEngine = renderer.gameEngine;\n        this.backLayer = renderer.layer1;\n        this.sprite = new PIXI.Container();\n        this.shipContainerSprite = new PIXI.Container();\n\n        this.shipSprite = new PIXI.Sprite(PIXI.loader.resources.ship.texture);\n\n        // keep a reference to the actor from the sprite\n        this.sprite.actor = this;\n\n\n        this.shipSprite.anchor.set(0.5, 0.5);\n        this.shipSprite.width = 50;\n        this.shipSprite.height = 45;\n\n\n        this.addThrustEmitter();\n        this.sprite.addChild(this.shipContainerSprite);\n        this.shipContainerSprite.addChild(this.shipSprite);\n    }\n\n    renderStep(delta) {\n        if (this.thrustEmitter) {\n            this.thrustEmitter.update(delta * 0.001);\n\n            this.thrustEmitter.spawnPos.x = this.sprite.x - Math.cos(-this.shipContainerSprite.rotation) * 4;\n            this.thrustEmitter.spawnPos.y = this.sprite.y + Math.sin(-this.shipContainerSprite.rotation) * 4;\n\n            this.thrustEmitter.minStartRotation = this.shipContainerSprite.rotation * 180 / Math.PI + 180 - 1;\n            this.thrustEmitter.maxStartRotation = this.shipContainerSprite.rotation * 180 / Math.PI + 180 + 1;\n        }\n        if (this.explosionEmitter){\n            this.explosionEmitter.update(delta * 0.001);\n        }\n\n    }\n\n    addThrustEmitter() {\n        this.thrustEmitter = new PIXI.particles.Emitter(\n            this.backLayer,\n            [PIXI.loader.resources.smokeParticle.texture],\n            ThrusterEmitterConfig\n        );\n        this.thrustEmitter.emit = false;\n\n        this.explosionEmitter = new PIXI.particles.Emitter(\n            this.shipContainerSprite,\n            [PIXI.loader.resources.smokeParticle.texture],\n            ExplosionEmitterConfig\n        );\n\n        this.explosionEmitter.emit = false;\n    }\n\n    changeName(name) {\n        if (this.nameText != null){\n            this.nameText.destroy();\n        }\n        this.nameText = new PIXI.Text(name, { fontFamily: 'arial', fontSize: '12px', fill: 'white' });\n        this.nameText.anchor.set(0.5, 0.5);\n        this.nameText.y = -40;\n        this.nameText.alpha = 0.3;\n        this.sprite.addChild(this.nameText);\n    }\n\n    destroy() {\n        return new Promise((resolve) =>{\n            this.explosionEmitter.emit = true;\n\n            if (this.nameText) this.nameText.destroy({ texture: false });\n            if (this.thrustEmitter) this.thrustEmitter.destroy();\n            if (this.shipSprite) this.shipSprite.destroy();\n            this.nameText = null;\n            this.thrustEmitter = null;\n            this.shipSprite = null;\n\n            setTimeout(()=>{\n                this.shipContainerSprite.destroy();\n                this.explosionEmitter.destroy();\n                resolve();\n            }, 300);\n        });\n    }\n\n}\n"],"mappings":"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"}