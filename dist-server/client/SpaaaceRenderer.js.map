{"version":3,"sources":["../../src/client/SpaaaceRenderer.js"],"names":["PIXI","SpaaaceRenderer","ship","missile","bg1","bg2","bg3","bg4","smokeParticle","gameEngine","clientEngine","require","sprites","isReady","assetPathPrefix","options","bgPhaseX","bgPhaseY","viewportWidth","window","innerWidth","viewportHeight","innerHeight","stage","Container","layer1","layer2","addChild","document","readyState","onDOMLoaded","addEventListener","Promise","resolve","reject","loader","add","Object","keys","ASSETPATHS","map","x","name","url","load","setupStage","Utils","isTouchDevice","body","classList","isMacintosh","isWindows","emit","renderer","autoDetectRenderer","querySelector","appendChild","view","setRendererSize","lookingAt","y","camera","extras","TilingSprite","resources","texture","blendMode","BLEND_MODES","ADD","alpha","elapsedTime","Date","now","getUrlVars","graphics","Graphics","beginFill","drawRect","worldSettings","width","height","resize","t","dt","worldWidth","worldHeight","viewportSeesRightBound","viewportSeesLeftBound","viewportSeesTopBound","viewportSeesBottomBound","objId","objData","world","objects","sprite","actor","thrustEmitter","showThrust","Ship","playerShip","updateOffscreenIndicator","position","shipContainerSprite","rotation","angle","Math","PI","renderStep","cameraTarget","gameStarted","getCentroid","cameraRoam","lookingAtDeltaX","lookingAtDeltaY","cameraTempTargetX","cameraTempTargetY","centerCamera","bgOffsetX","bgOffsetY","tilePosition","render","shipSprite","tint","remove","contains","disabled","style","opacity","setTimeout","targetX","targetY","isNaN","lastCameraPosition","container","indicatorEl","createElement","setAttribute","id","console","error","playerShipObj","slope","b","padding","indicatorPos","atan2","transform","parentNode","removeChild","data","RTT","qs","innerHTML","RTTAverage","truncateDecimals","scoreContainer","scoreArray","scoreEls","querySelectorAll","length","dataset","scoreEl","parseInt","changeName","kills","push","el","sort","a","e","keyName","isDown","isInFullScreen","fullScreenElement","mozFullScreen","webkitIsFullScreen","isIPhoneIPad","docElm","documentElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","obj","Renderer","maxDistance","shipCount","centroid","selectedShip","objDistance","sqrt","pow","selector","number","digits","multiplier","adjustedNum","truncatedNum","navigator","platform","indexOf","match"],"mappings":"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","sourcesContent":["let PIXI = null;\nimport { Renderer } from 'lance-gg';\nimport Utils from './../common/Utils';\nimport Ship from '../common/Ship';\n\n\n/**\n * Renderer for the Spaaace client - based on Pixi.js\n */\nexport default class SpaaaceRenderer extends Renderer {\n\n    get ASSETPATHS(){\n        return {\n            ship: 'assets/ship1.png',\n            missile: 'assets/shot.png',\n            bg1: 'assets/space3.png',\n            bg2: 'assets/space2.png',\n            bg3: 'assets/clouds2.png',\n            bg4: 'assets/clouds1.png',\n            smokeParticle: 'assets/smokeparticle.png'\n        };\n    }\n\n    // TODO: document\n    constructor(gameEngine, clientEngine) {\n        super(gameEngine, clientEngine);\n        PIXI = require('pixi.js');\n        this.sprites = {};\n        this.isReady = false;\n\n        // asset prefix\n        this.assetPathPrefix = this.gameEngine.options.assetPathPrefix?this.gameEngine.options.assetPathPrefix:'';\n\n        // these define how many gameWorlds the player ship has \"scrolled\" through\n        this.bgPhaseX = 0;\n        this.bgPhaseY = 0;\n    }\n\n    init() {\n        this.viewportWidth = window.innerWidth;\n        this.viewportHeight = window.innerHeight;\n\n        this.stage = new PIXI.Container();\n        this.layer1 = new PIXI.Container();\n        this.layer2 = new PIXI.Container();\n\n        this.stage.addChild(this.layer1, this.layer2);\n\n        if (document.readyState === 'complete' || document.readyState === 'loaded' || document.readyState === 'interactive') {\n            this.onDOMLoaded();\n        } else {\n            document.addEventListener('DOMContentLoaded', ()=>{\n                this.onDOMLoaded();\n            });\n        }\n\n        return new Promise((resolve, reject)=>{\n            PIXI.loader.add(Object.keys(this.ASSETPATHS).map((x)=>{\n                return{\n                    name: x,\n                    url: this.assetPathPrefix + this.ASSETPATHS[x]\n                };\n            }))\n            .load(() => {\n                this.isReady = true;\n                this.setupStage();\n\n                if (Utils.isTouchDevice()) {\n                    document.body.classList.add('touch');\n                } else if (isMacintosh()) {\n                    document.body.classList.add('mac');\n                } else if (isWindows()) {\n                    document.body.classList.add('pc');\n                }\n\n                resolve();\n\n                this.gameEngine.emit('renderer.ready');\n            });\n        });\n    }\n\n    onDOMLoaded(){\n        this.renderer = PIXI.autoDetectRenderer(this.viewportWidth, this.viewportHeight);\n        document.body.querySelector('.pixiContainer').appendChild(this.renderer.view);\n    }\n\n    setupStage() {\n        window.addEventListener('resize', ()=>{ this.setRendererSize(); });\n\n        this.lookingAt = { x: 0, y: 0 };\n        this.camera = new PIXI.Container();\n        this.camera.addChild(this.layer1, this.layer2);\n\n        // parallax background\n        this.bg1 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg1.texture,\n                this.viewportWidth, this.viewportHeight);\n        this.bg2 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg2.texture,\n            this.viewportWidth, this.viewportHeight);\n        this.bg3 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg3.texture,\n            this.viewportWidth, this.viewportHeight);\n        this.bg4 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg4.texture,\n            this.viewportWidth, this.viewportHeight);\n\n        this.bg3.blendMode = PIXI.BLEND_MODES.ADD;\n        this.bg4.blendMode = PIXI.BLEND_MODES.ADD;\n        this.bg4.alpha = 0.6;\n\n        this.stage.addChild(this.bg1, this.bg2, this.bg3, this.bg4);\n        this.stage.addChild(this.camera);\n\n        // this.debug= new PIXI.Graphics();\n        // this.camera.addChild(this.debug);\n\n        // this.debugText = new PIXI.Text('DEBUG', {fontFamily:\"arial\", fontSize: \"100px\", fill:\"white\"});\n        // this.debugText.anchor.set(0.5, 0.5);\n        // this.debugText.x = this.gameEngine.worldSettings.width/2;\n        // this.debugText.y = this.gameEngine.worldSettings.height/2;\n        // this.camera.addChild(this.debugText);\n\n        this.elapsedTime = Date.now();\n        // debug\n        if ('showworldbounds' in Utils.getUrlVars()) {\n            let graphics = new PIXI.Graphics();\n            graphics.beginFill(0xFFFFFF);\n            graphics.alpha = 0.1;\n            graphics.drawRect(0, 0, this.gameEngine.worldSettings.width, this.gameEngine.worldSettings.height);\n            this.camera.addChild(graphics);\n        }\n\n    }\n\n    setRendererSize() {\n        this.viewportWidth = window.innerWidth;\n        this.viewportHeight = window.innerHeight;\n\n        this.bg1.width = this.viewportWidth;\n        this.bg1.height = this.viewportHeight;\n        this.bg2.width = this.viewportWidth;\n        this.bg2.height = this.viewportHeight;\n        this.bg3.width = this.viewportWidth;\n        this.bg3.height = this.viewportHeight;\n        this.bg4.width = this.viewportWidth;\n        this.bg4.height = this.viewportHeight;\n\n        this.renderer.resize(this.viewportWidth, this.viewportHeight);\n    }\n\n    draw(t, dt) {\n        super.draw(t, dt);\n\n        let now = Date.now();\n\n        if (!this.isReady) return; // assets might not have been loaded yet\n        let worldWidth = this.gameEngine.worldSettings.width;\n        let worldHeight = this.gameEngine.worldSettings.height;\n\n        let viewportSeesRightBound = this.camera.x < this.viewportWidth - worldWidth;\n        let viewportSeesLeftBound = this.camera.x > 0;\n        let viewportSeesTopBound = this.camera.y > 0;\n        let viewportSeesBottomBound = this.camera.y < this.viewportHeight - worldHeight;\n\n        for (let objId of Object.keys(this.sprites)) {\n            let objData = this.gameEngine.world.objects[objId];\n            let sprite = this.sprites[objId];\n\n            if (objData) {\n\n                // if the object requests a \"showThrust\" then invoke it in the actor\n                if (sprite.actor && sprite.actor.thrustEmitter) {\n                    sprite.actor.thrustEmitter.emit = !!objData.showThrust;\n                }\n\n                if (objData instanceof Ship && sprite != this.playerShip) {\n                    this.updateOffscreenIndicator(objData);\n                }\n\n                sprite.x = objData.position.x;\n                sprite.y = objData.position.y;\n\n                if (objData instanceof Ship){\n                    sprite.actor.shipContainerSprite.rotation = this.gameEngine.world.objects[objId].angle * Math.PI/180;\n                } else{\n                    sprite.rotation = this.gameEngine.world.objects[objId].angle * Math.PI/180;\n                }\n\n                // make the wraparound seamless for objects other than the player ship\n                if (sprite != this.playerShip && viewportSeesLeftBound && objData.position.x > this.viewportWidth - this.camera.x) {\n                    sprite.x = objData.position.x - worldWidth;\n                }\n                if (sprite != this.playerShip && viewportSeesRightBound && objData.position.x < -this.camera.x) {\n                    sprite.x = objData.position.x + worldWidth;\n                }\n                if (sprite != this.playerShip && viewportSeesTopBound && objData.position.y > this.viewportHeight - this.camera.y) {\n                    sprite.y = objData.position.y - worldHeight;\n                }\n                if (sprite != this.playerShip && viewportSeesBottomBound && objData.position.y < -this.camera.y) {\n                    sprite.y = objData.position.y + worldHeight;\n                }\n            }\n\n            if (sprite) {\n                // object is either a Pixi sprite or an Actor. Actors have renderSteps\n                if (sprite.actor && sprite.actor.renderStep) {\n                    sprite.actor.renderStep(now - this.elapsedTime);\n                }\n            }\n\n            // this.emit(\"postDraw\");\n        }\n\n        let cameraTarget;\n        if (this.playerShip) {\n            cameraTarget = this.playerShip;\n            // this.cameraRoam = false;\n        } else if (!this.gameStarted && !cameraTarget) {\n\n            // calculate centroid\n            cameraTarget = getCentroid(this.gameEngine.world.objects);\n            this.cameraRoam = true;\n        }\n\n        if (cameraTarget) {\n            // let bgOffsetX = -this.bgPhaseX * worldWidth - cameraTarget.x;\n            // let bgOffsetY = -this.bgPhaseY * worldHeight - cameraTarget.y;\n\n            // 'cameraroam' in Utils.getUrlVars()\n            if (this.cameraRoam) {\n                let lookingAtDeltaX = cameraTarget.x - this.lookingAt.x;\n                let lookingAtDeltaY = cameraTarget.y - this.lookingAt.y;\n                let cameraTempTargetX;\n                let cameraTempTargetY;\n\n                if (lookingAtDeltaX > worldWidth / 2) {\n                    this.bgPhaseX++;\n                    cameraTempTargetX = this.lookingAt.x + worldWidth;\n                } else if (lookingAtDeltaX < -worldWidth / 2) {\n                    this.bgPhaseX--;\n                    cameraTempTargetX = this.lookingAt.x - worldWidth;\n                } else {\n                    cameraTempTargetX = this.lookingAt.x + lookingAtDeltaX * 0.02;\n                }\n\n                if (lookingAtDeltaY > worldHeight / 2) {\n                    cameraTempTargetY = this.lookingAt.y + worldHeight;\n                    this.bgPhaseY++;\n                } else if (lookingAtDeltaY < -worldHeight / 2) {\n                    this.bgPhaseY--;\n                    cameraTempTargetY = this.lookingAt.y - worldHeight;\n                } else {\n                    cameraTempTargetY = this.lookingAt.y + lookingAtDeltaY * 0.02;\n                }\n\n                this.centerCamera(cameraTempTargetX, cameraTempTargetY);\n\n            } else {\n                this.centerCamera(cameraTarget.x, cameraTarget.y);\n            }\n        }\n\n        let bgOffsetX = this.bgPhaseX * worldWidth + this.camera.x;\n        let bgOffsetY = this.bgPhaseY * worldHeight + this.camera.y;\n\n        this.bg1.tilePosition.x = bgOffsetX * 0.01;\n        this.bg1.tilePosition.y = bgOffsetY * 0.01;\n\n        this.bg2.tilePosition.x = bgOffsetX * 0.04;\n        this.bg2.tilePosition.y = bgOffsetY * 0.04;\n\n        this.bg3.tilePosition.x = bgOffsetX * 0.3;\n        this.bg3.tilePosition.y = bgOffsetY * 0.3;\n\n        this.bg4.tilePosition.x = bgOffsetX * 0.75;\n        this.bg4.tilePosition.y = bgOffsetY * 0.75;\n\n        this.elapsedTime = now;\n\n        // Render the stage\n        this.renderer.render(this.stage);\n    }\n\n    addPlayerShip(sprite) {\n        this.playerShip = sprite;\n        sprite.actor.shipSprite.tint = 0XFF00FF; // color  player ship\n        document.body.classList.remove('lostGame');\n        if (!document.body.classList.contains('tutorialDone')){\n            document.body.classList.add('tutorial');\n        }\n        document.body.classList.remove('lostGame');\n        document.body.classList.add('gameActive');\n        document.querySelector('#tryAgain').disabled = true;\n        document.querySelector('#joinGame').disabled = true;\n        document.querySelector('#joinGame').style.opacity = 0;\n\n        this.gameStarted = true; // todo state shouldn't be saved in the renderer\n\n        // remove the tutorial if required after a timeout\n        setTimeout(() => {\n            document.body.classList.remove('tutorial');\n        }, 10000);\n    }\n\n    /**\n     * Centers the viewport on a coordinate in the gameworld\n     * @param {Number} targetX\n     * @param {Number} targetY\n     */\n    centerCamera(targetX, targetY) {\n        if (isNaN(targetX) || isNaN(targetY)) return;\n        if (!this.lastCameraPosition){\n            this.lastCameraPosition = {};\n        }\n\n        this.lastCameraPosition.x = this.camera.x;\n        this.lastCameraPosition.y = this.camera.y;\n\n        this.camera.x = this.viewportWidth / 2 - targetX;\n        this.camera.y = this.viewportHeight / 2 - targetY;\n        this.lookingAt.x = targetX;\n        this.lookingAt.y = targetY;\n    }\n\n    addOffscreenIndicator(objData) {\n        let container = document.querySelector('#offscreenIndicatorContainer');\n        let indicatorEl = document.createElement('div');\n        indicatorEl.setAttribute('id', 'offscreenIndicator' + objData.id);\n        indicatorEl.classList.add('offscreenIndicator');\n        container.appendChild(indicatorEl);\n    }\n\n    updateOffscreenIndicator(objData){\n        // player ship might have been destroyed\n        if (!this.playerShip) return;\n\n        let indicatorEl = document.querySelector('#offscreenIndicator' + objData.id);\n        if (!indicatorEl) {\n            console.error(`No indicatorEl found with id ${objData.id}`);\n            return;\n        }\n        let playerShipObj = this.gameEngine.world.objects[this.playerShip.id];\n        let slope = (objData.position.y - playerShipObj.position.y) / (objData.position.x - playerShipObj.position.x);\n        let b = this.viewportHeight/ 2;\n\n        let padding = 30;\n        let indicatorPos = { x: 0, y: 0 };\n\n        if (objData.position.y < playerShipObj.position.y - this.viewportHeight/2) {\n            indicatorPos.x = this.viewportWidth/2 + (padding - b)/slope;\n            indicatorPos.y = padding;\n        } else if (objData.position.y > playerShipObj.position.y + this.viewportHeight/2) {\n            indicatorPos.x = this.viewportWidth/2 + (this.viewportHeight - padding - b)/slope;\n            indicatorPos.y = this.viewportHeight - padding;\n        }\n\n        if (objData.position.x < playerShipObj.position.x - this.viewportWidth/2) {\n            indicatorPos.x = padding;\n            indicatorPos.y = slope * (-this.viewportWidth/2 + padding) + b;\n        } else if (objData.position.x > playerShipObj.position.x + this.viewportWidth/2) {\n            indicatorPos.x = this.viewportWidth - padding;\n            indicatorPos.y = slope * (this.viewportWidth/2 - padding) + b;\n        }\n\n        if (indicatorPos.x == 0 && indicatorPos.y == 0){\n            indicatorEl.style.opacity = 0;\n        } else {\n            indicatorEl.style.opacity = 1;\n            let rotation = Math.atan2(objData.position.y - playerShipObj.position.y, objData.position.x - playerShipObj.position.x);\n            rotation = rotation * 180/Math.PI; // rad2deg\n            indicatorEl.style.transform = `translateX(${indicatorPos.x}px) translateY(${indicatorPos.y}px) rotate(${rotation}deg) `;\n        }\n    }\n\n    removeOffscreenIndicator(objData) {\n        let indicatorEl = document.querySelector('#offscreenIndicator'+objData.id);\n        if (indicatorEl && indicatorEl.parentNode)\n            indicatorEl.parentNode.removeChild(indicatorEl);\n    }\n\n    updateHUD(data){\n        if (data.RTT){ qs('.latencyData').innerHTML = data.RTT;}\n        if (data.RTTAverage){ qs('.averageLatencyData').innerHTML = truncateDecimals(data.RTTAverage, 2);}\n    }\n\n    updateScore(data){\n        let scoreContainer = qs('.score');\n        let scoreArray = [];\n\n        // remove score lines with objects that don't exist anymore\n        let scoreEls = scoreContainer.querySelectorAll('.line');\n        for (let x=0; x < scoreEls.length; x++){\n            if (data[scoreEls[x].dataset.objId] == null){\n                scoreEls[x].parentNode.removeChild(scoreEls[x]);\n            }\n        }\n\n        for (let id of Object.keys(data)){\n            let scoreEl = scoreContainer.querySelector(`[data-obj-id='${id}']`);\n            // create score line if it doesn't exist\n            if (scoreEl == null){\n                scoreEl = document.createElement('div');\n                scoreEl.classList.add('line');\n                if (this.playerShip && this.playerShip.id == parseInt(id)) scoreEl.classList.add('you');\n                scoreEl.dataset.objId = id;\n                scoreContainer.appendChild(scoreEl);\n            }\n\n            // stupid string/number conversion\n            if (this.sprites[parseInt(id)])\n                this.sprites[parseInt(id)].actor.changeName(data[id].name);\n\n            scoreEl.innerHTML = `${data[id].name}: ${data[id].kills}`;\n\n            scoreArray.push({\n                el: scoreEl,\n                data: data[id]\n            });\n        }\n\n        scoreArray.sort((a, b) => {return a.data.kills < b.data.kills;});\n\n        for (let x=0; x < scoreArray.length; x++){\n            scoreArray[x].el.style.transform = `translateY(${x}rem)`;\n        }\n\n    }\n\n    onKeyChange(e){\n        if (this.playerShip) {\n            if (e.keyName === 'up') {\n                this.playerShip.actor.thrustEmitter.emit = e.isDown;\n            }\n        }\n    }\n\n    enableFullScreen(){\n        let isInFullScreen = (document.fullScreenElement && document.fullScreenElement !== null) ||    // alternative standard method\n            (document.mozFullScreen || document.webkitIsFullScreen);\n\n        // iOS fullscreen generates user warnings\n        if (isIPhoneIPad()) return;\n\n        let docElm = document.documentElement;\n        if (!isInFullScreen) {\n\n            if (docElm.requestFullscreen) {\n                docElm.requestFullscreen();\n            } else if (docElm.mozRequestFullScreen) {\n                docElm.mozRequestFullScreen();\n            } else if (docElm.webkitRequestFullScreen) {\n                // NOTE: disabled on iOS/Safari, because it generated a\n                // phishing warning.\n                // docElm.webkitRequestFullScreen();\n            }\n        }\n    }\n\n    /*\n     * Takes in game coordinates and translates them into screen coordinates\n     * @param obj an object with x and y properties\n     */\n    gameCoordsToScreen(obj){\n        // console.log(obj.x , this.viewportWidth / 2 , this.camera.x)\n        return {\n            x: obj.position.x + this.camera.x,\n            y: obj.position.y + this.camera.y\n        };\n    }\n\n}\n\nfunction getCentroid(objects) {\n    let maxDistance = 500; // max distance to add to the centroid\n    let shipCount = 0;\n    let centroid = { x: 0, y: 0 };\n    let selectedShip = null;\n\n    for (let id of Object.keys(objects)){\n        let obj = objects[id];\n        if (obj instanceof Ship) {\n            if (selectedShip == null)\n                selectedShip = obj;\n\n            let objDistance = Math.sqrt( Math.pow((selectedShip.position.x-obj.position.y), 2) + Math.pow((selectedShip.position.y-obj.position.y), 2));\n            if (selectedShip == obj || objDistance < maxDistance) {\n                centroid.x += obj.position.x;\n                centroid.y += obj.position.y;\n                shipCount++;\n            }\n        }\n    }\n\n    centroid.x /= shipCount;\n    centroid.y /= shipCount;\n\n\n    return centroid;\n}\n\n// convenience function\nfunction qs(selector) { return document.querySelector(selector);}\n\nfunction truncateDecimals(number, digits) {\n    let multiplier = Math.pow(10, digits);\n    let adjustedNum = number * multiplier;\n    let truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);\n\n    return truncatedNum / multiplier;\n};\n\nfunction isMacintosh() {\n    return navigator.platform.indexOf('Mac') > -1;\n}\n\nfunction isWindows() {\n    return navigator.platform.indexOf('Win') > -1;\n}\n\nfunction isIPhoneIPad() {\n    return navigator.platform.match(/i(Phone|Pod)/i) !== null;\n}\n"],"file":"SpaaaceRenderer.js"}